# 교재 기반 퀴즈 제작 및 데이터 마이그레이션 가이드

이 문서는 '수학감각' 교재를 바탕으로 앱 내 퀴즈 데이터를 생성, 검수, 그리고 데이터베이스(Firestore)에 반영하는 전체 과정을 설명합니다.

---

## 1. 작업 목표
- 교재의 목차와 페이지 내용을 정확히 반영한 퀴즈 데이터 생성.
- 수학 수식(분수, 소수 등)의 올바른 웹 렌더링(LaTeX).
- 데이터베이스 구조(Region -> Chapter -> Unit -> Quiz)의 일관성 유지.

---

## 2. 📸 PDF 이미지 분석을 통한 교재 기반 퀴즈 생성

### 2.1 이미지 추출 워크플로우

교재 PDF에서 퀴즈를 생성하기 전에 반드시 이미지로 추출하여 분석해야 합니다.

#### macOS 사전 설치 (Poppler + pdf2image)
```bash
# Poppler 설치 (pdftoppm 포함)
brew install poppler

# 설치 확인
brew list poppler

# Python pdf2image 패키지 설치 (선택사항)
pip install pdf2image

# 설치 확인
pip list | grep pdf2image
```

#### PDF → 이미지 추출 명령어
```bash
# PDF를 이미지로 추출 (pdftoppm 사용)
pdftoppm -png "교재.pdf" output_prefix

# 또는 특정 페이지만
pdftoppm -png -f 76 -l 82 "나눗셈.pdf" unit9_pages
```

### 2.2 ⚠️ 반드시 피해야 할 실수들

#### ❌ 실수 1: 교재 표기법 무시
```
교재: 7 ÷ 2 = 3R1 (R 표기법)
잘못: 몫 3, 나머지 1
잘못: 3...1 (점 3개)
```
**교재의 정확한 표기법(R, ÷, × 등)을 그대로 사용해야 합니다.**

#### ❌ 실수 2: 일반적인 예제로 대체하기
```
교재: 잠자리 날개 4개, 개미 다리 6개, 35일=5주
잘못: 사과 5개씩, 연필 6자루씩 (일반적인 예제)
```
**교재의 구체적인 예제(생물 다리/날개, 시간 단위 등)를 그대로 반영해야 합니다.**

#### ❌ 실수 3: 단위 표현 방식 무시
```
교재: 4천 ÷ 2 = 2천, 8만 ÷ 2 = 4만 (우리말 단위)
잘못: 4000원을 2명에게 나누면? (숫자만 사용)
```
**교재가 "천", "백", "만" 같은 우리말 단위를 사용한다면 그대로 사용해야 합니다.**

#### ❌ 실수 4: 교재 문제 구조 무시
```
교재: (1) 14 ÷ 3 = 4R2  (2) 15 ÷ 4 = ?  (연습문제 구조)
잘못: 나눗셈에서 남는 양을 무엇이라 하나요? (개념 설명)
```
**교재가 연습문제 형식이면 그대로 연습문제 형식으로 만들어야 합니다.**

### 2.3 ✅ 올바른 이미지 분석 체크리스트

이미지 분석 시 다음 항목들을 반드시 확인하세요:

| 확인 항목 | 예시 |
|----------|------|
| **표기법** | R 표기, ÷, ×, 분수 형태 등 |
| **구체적 예제** | 동물 다리/날개, 시간 단위, 돈 단위 |
| **우리말 표현** | "4천 ÷ 2", "8만 ÷ 2", "5백 ÷ 5" |
| **문제 유형** | 연습문제 vs 개념 설명 vs 서술형 |
| **숫자 범위** | 교재에서 사용한 정확한 숫자들 |
| **힌트/설명** | 교재의 설명 방식 (포함제, 등분제 등) |

### 2.4 이미지 분석 → 퀴즈 생성 예시

**교재 이미지 (Unit 12, p100):**
```
12. 나머지(Remainder)
7 ÷ 2 = 3R1
구슬 7개를 2사람에게 똑같이 나누면, 한 사람이 몫으로 3개씩 갖고, 1개가 남습니다.

연습문제:
(1) 14 ÷ 3 = 4R2
(2) 15 ÷ 4 = ___
(3) 22 ÷ 6 = ___
(4) 20 ÷ 7 = ___
```

**생성할 퀴즈:**
```javascript
{
  id: 'div-12-1',
  question: '나눗셈에서 똑같이 나누어떨어지지 않을 때 남는 양을 나머지라고 합니다. 나머지를 나타내는 영어 Remainder의 앞 글자 R을 사용하여 나머지를 나타냅니다. $7 \\div 2$의 값은?',
  options: ['3R1', '4R0', '2R3', '3R2'],
  answer: '3R1',
  hint: '7을 2로 나누면 몫이 3이고 1이 남습니다. 3R1은 몫이 3이고 나머지가 1입니다.'
},
{
  id: 'div-12-2',
  question: '$14 \\div 3$의 값은?',
  options: ['4R2', '5R0', '3R5', '4R3'],
  answer: '4R2',
  hint: '14 안에는 3이 4번 포함되고 2가 남습니다.'
}
```

---

## 3. 파일 구조 및 역할

작업 시 주로 다루게 될 파일들은 다음과 같습니다.

| 파일 경로 | 역할 | 비고 |
|---|---|---|
| `src/data/regions.js` | 전체 대단원(Region), 챕터(Chapter), 유닛(Unit)의 구조와 메타데이터 정의 | **목차의 기준**이 되는 파일 |
| `src/data/decimalChapter2Quizzes.js` 등 | 실제 퀴즈 문제, 보기, 정답, 힌트 데이터가 담긴 파일 | 파일명은 챕터별로 구분 |
| `src/utils/seedFirestore.js` | 정의된 정적 데이터(JS)를 Firestore에 업로드하는 스크립트 | 데이터 매핑 로직 포함 |
| `src/pages/MigratePage.jsx` | 마이그레이션을 실행하는 관리자용 UI 페이지 | `/migrate` 경로 |

---

## 4. 작업 프로세스 상세

### 1단계: 목차 및 구조 정의 (`regions.js`)
가장 먼저 교재의 목차를 보고 `src/data/regions.js`에 구조를 잡아야 합니다.
*   **주의사항:** `regions.js`에 정의된 `id`와 순서는 데이터베이스의 키(Key)가 되므로 신중하게 작성해야 합니다.
*   **페이지 매핑:** 유닛 제목에 `(p123-130)`과 같이 교재 페이지를 명시하여 검수 시 혼동을 방지합니다.

```javascript
// 예시: regions.js
{
  id: 'decimals', // 대단원 ID
  chapters: [
    {
      id: 'chap6', // 챕터 ID
      title: '제2장: 소수의 사칙연산',
      units: [
        { id: 'unit9', title: '9. 자연수 나누기 자연수 (p132-136)' }, // 유닛 ID와 제목
        // ...
      ]
    }
  ]
}
```

### 2단계: 퀴즈 데이터 파일 생성 및 작성
각 챕터에 해당하는 JS 파일을 `src/data/` 폴더에 생성하거나 수정합니다.

#### 데이터 구조
```javascript
export const decimalChapter2Quizzes = {
  'unit9': { // regions.js의 unit ID와 일치해야 함
    title: '9. 자연수 나누기 자연수 (p132-136)',
    questions: [
      {
        id: '6-9-1', // 고유 ID (학년-단원-문제번호 규칙 권장)
        question: '$1 \\div 2$의 값은?', // 질문
        options: ['0.5', '0.2', '0.1', '0.05'], // 보기 (4지선다)
        answer: '0.5', // 정답 (보기 텍스트와 정확히 일치)
        hint: '1을 2로 나누면 반입니다.' // 힌트
      },
      // ...
    ]
  }
};
```

#### ⚠️ 중요: 수학 수식 (LaTeX) 작성 규칙
앱은 `KaTeX`를 사용하여 수식을 렌더링합니다. 따라서 **모든 수식은 `$` 기호로 감싸야 합니다.**

*   **분수 표현:**
    *   ❌ 잘못된 예: `1/2`, `\frac{1}{2}` (텍스트로만 나옴)
    *   ✅ 올바른 예: `$\frac{1}{2}$` (수식으로 렌더링됨)
    *   보기(Options)에도 적용 필수: `['$\\frac{1}{2}$', '$\\frac{1}{3}$', ...]`

*   **나눗셈 기호:**
    *   `÷` 기호 대신 `$\\div$`를 권장합니다. (예: `$1 \\div 2$`)
    *   곱셈은 `$\\times$`를 사용합니다.

### 3단계: 데이터 매핑 (`seedFirestore.js`)
새로 만든 퀴즈 파일이 있다면 `src/utils/seedFirestore.js`에 임포트하고 매핑을 추가해야 합니다.

```javascript
// src/utils/seedFirestore.js
import { decimalChapter2Quizzes } from '../data/decimalChapter2Quizzes.js';

const quizDataMapping = {
  // regions.js의 chapter ID : 임포트한 퀴즈 데이터 객체
  'chap6': decimalChapter2Quizzes,
  // ...
};
```

### 4단계: 데이터 마이그레이션 (DB 반영)
작성한 코드는 로컬 파일에만 존재하므로, 이를 Firestore 데이터베이스에 업로드해야 앱에서 볼 수 있습니다.

1.  로컬 개발 서버 실행: `npm run dev`
2.  마이그레이션 페이지 접속: `http://localhost:5173/migrate`
3.  **"Start Migration"** 버튼 클릭.
4.  콘솔(F12)에 "Seeding Complete!" 메시지가 뜨는지 확인.

---

## 5. 자주 발생하는 실수 (Checklist)

### 기본 실수
1.  **Unit ID 불일치:** `regions.js`의 unit ID와 퀴즈 파일의 key(`'unit9'`)가 다르면 퀴즈가 로드되지 않습니다.
2.  **페이지 밀림:** 중간에 유닛을 임의로 추가하거나 빼면, 이후 유닛들의 내용이 교재 페이지와 맞지 않게 됩니다. 반드시 교재 목차를 기준으로 인덱싱하세요.
3.  **LaTeX `$` 누락:** 분수나 수식이 렌더링되지 않고 `\frac...` 코드가 그대로 보인다면 `$` 기호가 빠진 것입니다.
4.  **정답 불일치:** `answer` 필드의 값은 `options` 배열에 있는 문자열과 **띄어쓰기 포함 정확히 일치**해야 정답 처리가 됩니다.

### 교재 기반 퀴즈 생성 실수 - 근본 원인 분석

아래는 실제 발생한 실수들과 **왜 그런 실수를 했는지** 근본 원인을 분석한 것입니다.

#### 실수 5: 나머지 표기법 오류 (`3R1` → `몫 3, 나머지 1`)

| 잘못된 판단 | 근본 원인 |
|------------|----------|
| "나머지"라는 개념이니까 한국어로 풀어서 표현해도 된다고 생각함 | **이미지를 분석하지 않고 단원 제목("12. 나머지")만 보고 내용을 추측함.** 교재 이미지를 직접 보면 `7 ÷ 2 = 3R1` 형식이 명확히 나와 있음. |

#### 실수 6: 일반화된 예제 (`잠자리 날개` → `사과`)

| 잘못된 판단 | 근본 원인 |
|------------|----------|
| "묶음으로 생각하기"니까 아무 물건이든 묶으면 된다고 생각함 | **교재 이미지 분석 없이 단원 제목으로 "비슷한" 예제를 임의 생성함.** 교재에서는 생물학적 특성(잠자리 날개 4개, 개미 다리 6개)과 시간(35일=5주)을 활용한 특수한 예제를 사용함. |

#### 실수 7: 단위 표현 무시 (`4천 ÷ 2` → `4000원을 2명에게`)

| 잘못된 판단 | 근본 원인 |
|------------|----------|
| "돈으로 나누기"니까 일반적인 돈 나눗셈 문제를 만들면 된다고 생각함 | **단원 제목에서 "돈"이라는 단어만 보고 내용을 추측함.** 교재의 핵심은 "4천 ÷ 2 = 2천" 형식으로 **우리말 단위를 활용한 자릿값 이해**인데, 이를 무시하고 일반적인 돈 계산 문제로 대체함. |

#### 실수 8: 숫자 임의 변경 (`14÷3` → `7÷2`)

| 잘못된 판단 | 근본 원인 |
|------------|----------|
| 나눗셈 개념은 같으니까 어떤 숫자든 상관없다고 생각함 | **교재 연습문제의 정확한 숫자를 확인하지 않음.** 교재에서 `14÷3`, `15÷4`, `22÷6`, `20÷7`을 사용한 이유가 있을 수 있음 (난이도 조절, 계열성 등). |

---

### 🔍 왜 "교재 기반"이라고 착각했는가?

1. **이미지 분석을 건너뛰었음**: PDF를 이미지로 추출하지 않고, 목차나 단원 제목만 보고 내용을 추측함.
2. **"비슷하면 된다"는 사고방식**: 개념이 같으면 예제도 바꿔도 된다고 판단함. 하지만 교재는 특정 예제를 선택한 교육적 의도가 있음.
3. **검증 없이 "완료" 처리**: 교재 이미지와 생성된 퀴즈를 1:1 비교하지 않고 "교재 기반"이라고 결론냄.
4. **표면적 유사성에 속음**: 단원 제목("돈으로 나누기", "나머지")과 퀴즈 주제가 같으면 교재 기반이라고 착각함.

---

### ✅ 올바른 접근법

```
1. 반드시 PDF → 이미지 추출 먼저
2. 이미지에서 표기법, 예제, 숫자를 정확히 확인
3. 퀴즈 생성 후 이미지와 1:1 대조 검수
4. "비슷한" 예제 금지 - 교재 그대로 사용
```

---

## 6. 검수 프로세스

### 검수 체크리스트
- [ ] 교재 이미지와 퀴즈 문제 1:1 비교
- [ ] 표기법 일치 확인 (R표기, 분수, 나눗셈 기호)
- [ ] 구체적 예제 반영 확인 (동물, 시간, 돈 단위 등)
- [ ] 힌트가 교재 설명과 일치하는지 확인
- [ ] 앱에서 실제 렌더링 확인

이 가이드를 준수하여 작업을 진행해 주시기 바랍니다.

